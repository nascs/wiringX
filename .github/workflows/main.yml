name: Build Project
on:
  workflow_dispatch:
  pull_request:
  push:
    branches:
      - github_action

permissions:
  contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Installation depends
        run: |
          echo "Preparing environment..."
          sudo apt-get update
          sudo apt-get install -y python2-dev python2.7 python-dev-is-python3 python3 python3.9 git build-essential swig libnode-dev cmake libjson-c-dev libc6 libgcc1 libstdc++6 libgtest-dev pkg-config cmake-data
          echo "Environment setup complete."
      - name: Set up build env
        run: |
          echo  "============== $PWD =============="
          mkdir build && cd build && cmake .. 
          working-directory: ./build
      - name: Build project
        run:    
          make -j8 && cpack -G DEB
          echo  "======== Build complete ====== $PWD =============="
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: wiringx-deb
          path: ./*.deb

  # upload:
  #   needs: [build] # 声明 upload 作业依赖于 build 作业
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Upload artifact
  #       uses: actions/download-artifact@v4
  #       with:
  #         name: wiringx-deb
  #         path: ./build
  #     - name: Create release
  #       id: create_release
  #       uses: actions/create-release@v1
  #       env: 
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       with:
  #         tag_name: ${{ github.ref }}
  #         release_name: Release ${{ github.ref }}
  #         body: Automated build of WiringX
  #         draft: false
  #         prerelease: false
  #     - name: Upload release asset
  #       id: upload-release-asset
  #       uses: actions/upload-release-asset@v1
  #       env:
  #         GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
  #       with:
  #         upload_url: ${{ steps.create_release.outputs.upload_url }}
  #         asset_path: ./build/*.deb
  #         asset_name: wiringX.deb
  #         asset_content_type: application/x-deb


